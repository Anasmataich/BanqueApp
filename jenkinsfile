pipeline { 
    agent any   
    stages {
        stage('Checkout') {
            steps {
                git(
                    url: 'https://github.com/Anasmataich/BanqueApp.git',
                    branch: 'feature-virement'
                )
            }
        }

        stage('Run Tests') {
            steps {
                bat '''
                echo "Creation de l'environnement virtuel..."
                python -m venv venv

                echo "Activation de l'environnement..."
                call .\\venv\\Scripts\\activate.bat
                
                echo "Installation de pytest..."
                pip install pytest
                

                echo "Lancement des tests unitaires avec Pytest (sortie console)..."
                
                REM On retire "> test_results.txt" pour voir la sortie dans Jenkins
                pytest -v
                '''
            }
        }

        stage('Run the App') {
            steps {
                bat 'python main.py --auto'
            }
        }
    }
}